<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœå¥å­æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .tab-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .tab-btn.active {
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            color: #1a1a2e;
            font-weight: bold;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card h2 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #00d9ff;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #00d9ff;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .code-output {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            word-break: break-all;
            font-family: monospace;
            font-size: 0.9rem;
            display: none;
        }

        .code-output.show {
            display: block;
        }

        .code-label {
            color: #00ff88;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .code-value {
            color: #fff;
            user-select: all;
        }

        .copy-btn {
            margin-top: 10px;
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        /* Game area styles */
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .attempts-count {
            color: #00ff88;
            font-size: 1.1rem;
        }

        .hint-text {
            color: #888;
            font-size: 0.9rem;
        }

        .guesses-container {
            margin-bottom: 20px;
        }

        .guess-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .char-box {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .char-box.correct {
            background: #22c55e;
            color: #fff;
            animation: pop 0.3s ease;
        }

        .char-box.present {
            background: #eab308;
            color: #1a1a2e;
            animation: pop 0.3s ease;
        }

        .char-box.absent {
            background: #4b5563;
            color: #9ca3af;
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .game-result {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }

        .game-result.show {
            display: block;
        }

        .game-result.win {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid #22c55e;
        }

        .game-result.lose {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
        }

        .game-result h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .game-result.win h3 {
            color: #22c55e;
        }

        .game-result.lose h3 {
            color: #ef4444;
        }

        .answer-reveal {
            margin-top: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 1.2rem;
        }

        .hint-area {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 10px;
            display: none;
        }

        .hint-area.show {
            display: block;
        }

        .hint-title {
            color: #00d9ff;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .hint-content {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .hint-char {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .hint-char.revealed {
            background: #22c55e;
            border: none;
            color: #fff;
        }

        .hint-count {
            margin-top: 10px;
            font-size: 0.85rem;
            color: #888;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .legend-box {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }

        .legend-box.correct { background: #22c55e; }
        .legend-box.present { background: #eab308; }
        .legend-box.absent { background: #4b5563; }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Share link display */
        .share-link {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 217, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            display: none;
        }

        .share-link.show {
            display: block;
        }

        .share-link-label {
            color: #00d9ff;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .share-link-url {
            word-break: break-all;
            font-size: 0.85rem;
            color: #fff;
            user-select: all;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            .char-box {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .card {
                padding: 20px;
            }

            .tab-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ çŒœå¥å­</h1>
        <p class="subtitle">Wordle é£æ ¼çš„ä¸­æ–‡çŒœå¥æ¸¸æˆ</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('play')">å¼€å§‹æ¸¸æˆ</button>
            <button class="tab-btn" onclick="switchTab('create')">åˆ›å»ºé¢˜ç›®</button>
            <button class="tab-btn" onclick="switchTab('check')">è‡ªæŸ¥å·¥å…·</button>
        </div>

        <!-- Play Game Tab -->
        <div id="play-tab" class="tab-content active">
            <div class="card">
                <h2>ğŸ“ è¾“å…¥æ¸¸æˆç å¼€å§‹</h2>
                <div class="input-group">
                    <label>ç²˜è´´ä½ æœ‹å‹åˆ†äº«çš„æ¸¸æˆç ï¼š</label>
                    <input type="text" id="game-code-input" placeholder="åœ¨è¿™é‡Œç²˜è´´æ¸¸æˆç ...">
                </div>
                <button class="btn btn-primary" onclick="startGame()">å¼€å§‹çŒœå¥</button>
            </div>

            <div id="game-area" class="card" style="display: none;">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box correct"></div>
                        <span>ä½ç½®æ­£ç¡®</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box present"></div>
                        <span>å­—å¯¹ä½ç½®é”™</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box absent"></div>
                        <span>æ²¡æœ‰è¿™ä¸ªå­—</span>
                    </div>
                </div>

                <div class="game-info">
                    <span class="attempts-count">ç¬¬ <span id="attempt-num">1</span> æ¬¡å°è¯•</span>
                    <span class="hint-text">å¥å­é•¿åº¦ï¼š<span id="sentence-length">0</span> ä¸ªå­—ç¬¦ï¼ˆä¸å«æ ‡ç‚¹ï¼‰</span>
                </div>

                <div id="guesses-container" class="guesses-container"></div>

                <div class="input-group">
                    <input type="text" id="guess-input" placeholder="è¾“å…¥ä½ çš„çŒœæµ‹...">
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="submitGuess()">æäº¤çŒœæµ‹</button>
                    <button class="btn btn-secondary" onclick="getHint()">ğŸ’¡ æç¤º</button>
                    <button class="btn btn-secondary" onclick="giveUp()">ğŸ³ï¸ è®¤è¾“</button>
                </div>

                <div id="hint-area" class="hint-area"></div>

                <div id="game-result" class="game-result">
                    <h3 id="result-title"></h3>
                    <p id="result-message"></p>
                    <div class="answer-reveal">
                        ç­”æ¡ˆï¼š<strong id="answer-text"></strong>
                    </div>
                    <button class="btn btn-secondary" style="margin-top: 15px;" onclick="resetGame()">å†æ¥ä¸€å±€</button>
                </div>
            </div>
        </div>

        <!-- Create Puzzle Tab -->
        <div id="create-tab" class="tab-content">
            <div class="card">
                <h2>âœ¨ åˆ›å»ºæ–°é¢˜ç›®</h2>
                <div class="input-group">
                    <label>è¾“å…¥ä½ æƒ³è®©æœ‹å‹çŒœçš„å¥å­ï¼š</label>
                    <textarea id="sentence-input" placeholder="ä¾‹å¦‚ï¼šä»Šå¤©å¤©æ°”çœŸå¥½"></textarea>
                </div>
                <button class="btn btn-primary" onclick="generateCode()">ç”Ÿæˆæ¸¸æˆç </button>

                <div id="code-output" class="code-output">
                    <div class="code-label">ğŸ” æ¸¸æˆç ï¼ˆå‘ç»™ä½ çš„æœ‹å‹ï¼‰ï¼š</div>
                    <div id="code-value" class="code-value"></div>
                    <button class="btn btn-secondary copy-btn" onclick="copyCode()">ğŸ“‹ å¤åˆ¶æ¸¸æˆç </button>
                </div>

                <div id="share-link" class="share-link">
                    <div class="share-link-label">ğŸ”— æˆ–è€…ç›´æ¥åˆ†äº«è¿™ä¸ªé“¾æ¥ï¼š</div>
                    <div id="share-link-url" class="share-link-url"></div>
                    <button class="btn btn-secondary copy-btn" onclick="copyLink()">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
                </div>
            </div>
        </div>

        <!-- Self Check Tab -->
        <div id="check-tab" class="tab-content">
            <div class="card">
                <h2>ğŸ” è‡ªæŸ¥å·¥å…·</h2>
                <p style="color: #888; margin-bottom: 20px;">è¾“å…¥ç­”æ¡ˆå’ŒçŒœæµ‹ï¼ŒæŸ¥çœ‹é¢œè‰²åé¦ˆï¼ˆæ ‡ç‚¹ç¬¦å·ä¼šè¢«å¿½ç•¥ï¼‰</p>
                
                <div class="legend" style="margin-bottom: 25px;">
                    <div class="legend-item">
                        <div class="legend-box correct"></div>
                        <span>ä½ç½®æ­£ç¡®</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box present"></div>
                        <span>å­—å¯¹ä½ç½®é”™</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box absent"></div>
                        <span>æ²¡æœ‰è¿™ä¸ªå­—</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>æ­£ç¡®ç­”æ¡ˆï¼š</label>
                    <input type="text" id="check-answer" placeholder="è¾“å…¥æ­£ç¡®ç­”æ¡ˆ...">
                </div>
                <div class="input-group">
                    <label>ä½ çš„çŒœæµ‹ï¼š</label>
                    <input type="text" id="check-guess" placeholder="è¾“å…¥çŒœæµ‹...">
                </div>
                <button class="btn btn-primary" onclick="selfCheck()">æŸ¥çœ‹åé¦ˆ</button>

                <div id="check-result" class="guesses-container" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentAnswer = '';
        let attemptCount = 0;
        let gameOver = false;
        let revealedIndices = new Set();
        let hintCount = 0;

        // Punctuation regex - matches Chinese and English punctuation
        const punctuationRegex = /[ï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼š""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹â€”â€¦Â·\s,.!?;:'"()\[\]{}<>\/\\@#$%^&*+=|~`_-]/g;

        // Remove punctuation from string
        function removePunctuation(str) {
            return str.replace(punctuationRegex, '');
        }

        // Check if character is punctuation
        function isPunctuation(char) {
            return punctuationRegex.test(char);
        }

        // Compare guess with answer, considering punctuation
        function compareStrings(answer, guess) {
            const cleanAnswer = removePunctuation(answer);
            const cleanGuess = removePunctuation(guess);
            
            const result = [];
            const answerChars = [...cleanAnswer];
            const guessChars = [...cleanGuess];
            const answerCharCount = {};

            // Count characters in answer
            answerChars.forEach(char => {
                answerCharCount[char] = (answerCharCount[char] || 0) + 1;
            });

            // First pass: mark correct positions
            guessChars.forEach((char, i) => {
                if (char === answerChars[i]) {
                    result[i] = { char, status: 'correct' };
                    answerCharCount[char]--;
                } else {
                    result[i] = { char, status: 'pending' };
                }
            });

            // Second pass: mark present or absent
            result.forEach((item, i) => {
                if (item.status === 'pending') {
                    if (answerCharCount[item.char] > 0) {
                        item.status = 'present';
                        answerCharCount[item.char]--;
                    } else {
                        item.status = 'absent';
                    }
                }
            });

            return result;
        }

        // Simple encoding/decoding using Base64 with a twist
        function encode(str) {
            // Add a simple salt and encode
            const salt = 'wordle_game_v1_';
            const combined = salt + str;
            // Convert to Base64 and reverse it for extra obfuscation
            const base64 = btoa(unescape(encodeURIComponent(combined)));
            return base64.split('').reverse().join('');
        }

        function decode(encoded) {
            try {
                // Reverse and decode Base64
                const reversed = encoded.split('').reverse().join('');
                const decoded = decodeURIComponent(escape(atob(reversed)));
                const salt = 'wordle_game_v1_';
                if (decoded.startsWith(salt)) {
                    return decoded.substring(salt.length);
                }
                return null;
            } catch (e) {
                return null;
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'play') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('play-tab').classList.add('active');
            } else if (tab === 'create') {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('create-tab').classList.add('active');
            } else {
                document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                document.getElementById('check-tab').classList.add('active');
            }
        }

        function generateCode() {
            const sentence = document.getElementById('sentence-input').value.trim();
            if (!sentence) {
                alert('è¯·è¾“å…¥ä¸€ä¸ªå¥å­ï¼');
                return;
            }

            const code = encode(sentence);
            document.getElementById('code-value').textContent = code;
            document.getElementById('code-output').classList.add('show');

            // Generate shareable link
            const url = new URL(window.location.href);
            url.hash = '';
            url.search = '?code=' + encodeURIComponent(code);
            document.getElementById('share-link-url').textContent = url.toString();
            document.getElementById('share-link').classList.add('show');
        }

        function copyCode() {
            const code = document.getElementById('code-value').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('æ¸¸æˆç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function copyLink() {
            const link = document.getElementById('share-link-url').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function startGame() {
            const code = document.getElementById('game-code-input').value.trim();
            if (!code) {
                alert('è¯·è¾“å…¥æ¸¸æˆç ï¼');
                return;
            }

            const decoded = decode(code);
            if (!decoded) {
                alert('æ— æ•ˆçš„æ¸¸æˆç ï¼Œè¯·æ£€æŸ¥åé‡è¯•ï¼');
                return;
            }

            currentAnswer = decoded;
            attemptCount = 0;
            gameOver = false;
            revealedIndices = new Set();
            hintCount = 0;

            document.getElementById('game-area').style.display = 'block';
            document.getElementById('sentence-length').textContent = removePunctuation(currentAnswer).length;
            document.getElementById('guesses-container').innerHTML = '';
            document.getElementById('game-result').classList.remove('show', 'win', 'lose');
            document.getElementById('hint-area').classList.remove('show');
            document.getElementById('hint-area').innerHTML = '';
            document.getElementById('guess-input').value = '';
            document.getElementById('guess-input').disabled = false;
            updateAttemptCount();
        }

        function updateAttemptCount() {
            document.getElementById('attempt-num').textContent = attemptCount + 1;
        }

        function submitGuess() {
            if (gameOver) return;

            const guess = document.getElementById('guess-input').value;
            if (!guess) {
                alert('è¯·è¾“å…¥ä½ çš„çŒœæµ‹ï¼');
                return;
            }

            const cleanGuess = removePunctuation(guess);
            const cleanAnswer = removePunctuation(currentAnswer);

            if (cleanGuess.length !== cleanAnswer.length) {
                alert(`å¥å­é•¿åº¦åº”è¯¥æ˜¯ ${cleanAnswer.length} ä¸ªå­—ç¬¦ï¼ˆä¸å«æ ‡ç‚¹ï¼‰ï¼Œä½ è¾“å…¥äº† ${cleanGuess.length} ä¸ªå­—ç¬¦`);
                return;
            }

            attemptCount++;
            
            // Compare and get result
            const result = compareStrings(currentAnswer, guess);

            // Display the guess
            displayGuess(result);

            // Check if won
            if (cleanGuess === cleanAnswer) {
                gameWon();
            } else {
                document.getElementById('guess-input').value = '';
                updateAttemptCount();
            }
        }

        function displayGuess(result) {
            const container = document.getElementById('guesses-container');
            const row = document.createElement('div');
            row.className = 'guess-row';

            result.forEach((item, index) => {
                const box = document.createElement('div');
                box.className = 'char-box';
                box.textContent = item.char;
                
                // Add animation delay
                setTimeout(() => {
                    box.classList.add(item.status);
                }, index * 100);

                row.appendChild(box);
            });

            container.appendChild(row);
            container.scrollTop = container.scrollHeight;
        }

        function gameWon() {
            gameOver = true;
            document.getElementById('guess-input').disabled = true;
            
            const resultDiv = document.getElementById('game-result');
            resultDiv.classList.add('show', 'win');
            document.getElementById('result-title').textContent = 'ğŸ‰ æ­å–œä½ çŒœå¯¹äº†ï¼';
            let message = `ä½ ç”¨äº† ${attemptCount} æ¬¡å°è¯•`;
            if (hintCount > 0) {
                message += `ï¼Œä½¿ç”¨äº† ${hintCount} æ¬¡æç¤º`;
            }
            document.getElementById('result-message').textContent = message;
            document.getElementById('answer-text').textContent = currentAnswer;
        }

        function getHint() {
            if (gameOver) return;

            const cleanAnswer = removePunctuation(currentAnswer);
            const totalChars = cleanAnswer.length;
            
            // Find unrevealed indices
            const unrevealedIndices = [];
            for (let i = 0; i < totalChars; i++) {
                if (!revealedIndices.has(i)) {
                    unrevealedIndices.push(i);
                }
            }

            if (unrevealedIndices.length === 0) {
                alert('æ‰€æœ‰å­—ç¬¦éƒ½å·²æç¤ºï¼');
                return;
            }

            // Reveal a random unrevealed character
            const randomIndex = unrevealedIndices[Math.floor(Math.random() * unrevealedIndices.length)];
            revealedIndices.add(randomIndex);
            hintCount++;

            // Update hint display
            updateHintDisplay();
        }

        function updateHintDisplay() {
            const cleanAnswer = removePunctuation(currentAnswer);
            const hintArea = document.getElementById('hint-area');
            
            let html = '<div class="hint-title">ğŸ’¡ å·²æ­ç¤ºçš„å­—ç¬¦ï¼š</div>';
            html += '<div class="hint-content">';
            
            for (let i = 0; i < cleanAnswer.length; i++) {
                if (revealedIndices.has(i)) {
                    html += `<div class="hint-char revealed">${cleanAnswer[i]}</div>`;
                } else {
                    html += `<div class="hint-char">?</div>`;
                }
            }
            
            html += '</div>';
            html += `<div class="hint-count">å·²ä½¿ç”¨ ${hintCount} æ¬¡æç¤ºï¼Œè¿˜å‰© ${cleanAnswer.length - revealedIndices.size} ä¸ªå­—ç¬¦æœªæ­ç¤º</div>`;
            
            hintArea.innerHTML = html;
            hintArea.classList.add('show');
        }

        function giveUp() {
            if (gameOver) return;
            
            if (!confirm('ç¡®å®šè¦è®¤è¾“å—ï¼Ÿå°†ä¼šæ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆã€‚')) {
                return;
            }
            
            gameOver = true;
            document.getElementById('guess-input').disabled = true;
            
            const resultDiv = document.getElementById('game-result');
            resultDiv.classList.add('show', 'lose');
            document.getElementById('result-title').textContent = 'ğŸ˜… æ²¡å…³ç³»ï¼Œä¸‹æ¬¡å†è¯•ï¼';
            let message = `ä½ å°è¯•äº† ${attemptCount} æ¬¡`;
            if (hintCount > 0) {
                message += `ï¼Œä½¿ç”¨äº† ${hintCount} æ¬¡æç¤º`;
            }
            document.getElementById('result-message').textContent = message;
            document.getElementById('answer-text').textContent = currentAnswer;
        }

        function resetGame() {
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('game-code-input').value = '';
            currentAnswer = '';
            attemptCount = 0;
            gameOver = false;
            revealedIndices = new Set();
            hintCount = 0;
        }

        function selfCheck() {
            const answer = document.getElementById('check-answer').value;
            const guess = document.getElementById('check-guess').value;

            if (!answer || !guess) {
                alert('è¯·è¾“å…¥ç­”æ¡ˆå’ŒçŒœæµ‹ï¼');
                return;
            }

            const cleanAnswer = removePunctuation(answer);
            const cleanGuess = removePunctuation(guess);

            if (cleanGuess.length !== cleanAnswer.length) {
                alert(`ç­”æ¡ˆæœ‰ ${cleanAnswer.length} ä¸ªå­—ç¬¦ï¼ˆä¸å«æ ‡ç‚¹ï¼‰ï¼ŒçŒœæµ‹æœ‰ ${cleanGuess.length} ä¸ªå­—ç¬¦ï¼ˆä¸å«æ ‡ç‚¹ï¼‰ï¼Œé•¿åº¦ä¸åŒ¹é…ï¼`);
                return;
            }

            const result = compareStrings(answer, guess);
            
            // Display result
            const container = document.getElementById('check-result');
            container.innerHTML = '';
            
            const row = document.createElement('div');
            row.className = 'guess-row';

            result.forEach((item, index) => {
                const box = document.createElement('div');
                box.className = 'char-box';
                box.textContent = item.char;
                
                setTimeout(() => {
                    box.classList.add(item.status);
                }, index * 100);

                row.appendChild(box);
            });

            container.appendChild(row);

            // Show if it's correct
            if (cleanGuess === cleanAnswer) {
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'text-align: center; margin-top: 15px; color: #22c55e; font-size: 1.2rem;';
                successMsg.textContent = 'âœ… å®Œå…¨æ­£ç¡®ï¼';
                container.appendChild(successMsg);
            }
        }

        // Handle Enter key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'guess-input') {
                    submitGuess();
                } else if (activeElement.id === 'game-code-input') {
                    startGame();
                }
            }
        });

        // Check for code in URL on page load
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                document.getElementById('game-code-input').value = code;
                startGame();
            }
        });
    </script>
</body>
</html>
